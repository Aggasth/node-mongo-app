pipeline {
    agent {
        docker { image 'atejada1127/azure-cli-kubectl'}
    }
    stages {
        stage('Load Git Files') {
            steps {
                git https://github.com/Aggasth/node-mongo-app.git
            }
        }
        stage('Load Config') {
            steps {
                script {
                    def config = readJSON file: 'config.json'
                    env.AZURE_CLIENT_ID = config.AZURE_CLIENT_ID
                    env.AZURE_CLIENT_SECRET = config.AZURE_CLIENT_SECRET
                    env.AZURE_TENANT_ID = config.AZURE_TENANT_ID
                    env.WEBAPP_NAME = config.WEBAPP_NAME
                    env.RESOURCE_GROUP_NAME = config.RESOURCE_GROUP_NAME
                }
            }
        }
        stage('Azure Login') {
            steps {
                script {
                    withAzureCredentials(env.AZURE_CLIENT_ID, env.AZURE_CLIENT_SECRET, env.AZURE_TENANT_ID, 'Azure') {
                        sh 'az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET --tenant $AZURE_TENANT_ID'
                    }
                }
            }
        }
    }
}